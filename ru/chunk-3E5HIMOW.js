import{a as j}from"./chunk-ETNQ4JEP.js";import{a as V,b as z,c as G,d as X}from"./chunk-KOZ2ZCVV.js";import{a as Q}from"./chunk-GKH7LAPC.js";import{a as U,b as W}from"./chunk-ZUSBWXLF.js";import{I as M,Ia as v,N as c,Ob as k,Pb as B,S as m,Sa as g,T as p,Ta as _,U as S,Va as P,Wa as x,Xa as C,Ya as s,Za as l,_a as u,cb as N,da as h,eb as b,fb as A,jb as y,kb as D,lb as I,mb as T,nb as E,pb as L,qb as R,rb as H,sa as w,sb as O,ub as $,va as d,vb as F}from"./chunk-SUHW4BGF.js";var f=class o{http=c(W);configService=c(Q);sendMessage(t,e="guest"){let n=this.configService.get("BACKEND_URL_ONLINE")+"/chat/message";console.log("api_url",n);let i=new U();return typeof Telegram<"u"&&Telegram.WebApp&&Telegram.WebApp.initData&&(i=i.set("x-telegram-init-data",Telegram.WebApp.initData)),this.http.post(n,{message:t,chatId:e},{headers:i});}static ɵfac=function(e){return new(e||o)();};static ɵprov=M({token:o,factory:o.ɵfac,providedIn:"root"});};var q=["scrollContainer"],J=(o,t)=>t.time;function Z(o,t){o&1&&u(0,"div",23);}function ee(o,t){o&1&&u(0,"div",24);}function te(o,t){if(o&1&&(s(0,"div",21)(1,"div",22),g(2,Z,1,0,"div",23),g(3,ee,1,0,"div",24),u(4,"p",25),l(),s(5,"span",26),E(6),$(7,"date"),l()()),o&2){let e=t.$implicit;T("items-end",e.role==="user")("items-start",e.role==="bot"),d(),T("bg-gradient-to-br",e.role==="user")("from-rose-500",e.role==="user")("to-rose-600",e.role==="user")("text-white",e.role==="user")("rounded-br-none",e.role==="user")("bg-white",e.role==="bot")("text-gray-700",e.role==="bot")("border",e.role==="bot")("border-rose-100",e.role==="bot")("rounded-bl-none",e.role==="bot")("shadow-sm",e.role==="bot"),d(),_(e.role==="bot"?2:-1),d(),_(e.role==="user"?3:-1),d(),C("innerHTML",e.text,w),d(2),L(" ",F(7,30,e.time,"HH:mm")," ");}}function ne(o,t){o&1&&(s(0,"div",14),u(1,"div",27)(2,"div",28)(3,"div",29),l());}var K=class o{scrollContainer;langugaeService=c(j);messages=h([{role:"bot",text:"\u0417\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435! \u042F \u0432\u0430\u0448 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u043D\u0442 \u043A\u043B\u0438\u043D\u0438\u043A\u0438 AAA Cosmetics. \u0427\u0435\u043C \u044F \u043C\u043E\u0433\u0443 \u0432\u0430\u043C \u043F\u043E\u043C\u043E\u0447\u044C \u0441\u0435\u0433\u043E\u0434\u043D\u044F?",time:new Date()}]);newMessage="";isLoading=h(!1);chatService=c(f);ngOnInit(){this.scrollToBottom();}ngAfterViewChecked(){this.scrollToBottom();}scrollToBottom(){try{this.scrollContainer?.nativeElement&&(this.scrollContainer.nativeElement.scrollTop=this.scrollContainer.nativeElement.scrollHeight);}catch(t){console.error("Scroll error:",t);}}onEnter(t){t instanceof KeyboardEvent&&!t.shiftKey&&(t.preventDefault(),this.sendMessage());}autoResize(t){let e=t.target;e.style.height="auto",e.style.height=e.scrollHeight+"px";}userData(){let t=window.Telegram?.WebApp;return t?t.initDataUnsafe?.user:null;}sendMessage(){if(!this.newMessage.trim()||this.isLoading())return;let t=this.userData(),e=this.langugaeService.getLanguage(),n=this.newMessage.trim();this.messages.update(a=>[...a,{role:"user",text:n,time:new Date()}]),this.newMessage="",this.isLoading.set(!0),typeof Telegram<"u"&&Telegram.WebApp&&Telegram.WebApp.HapticFeedback.impactOccurred("light");let i="guest";typeof Telegram<"u"&&Telegram.WebApp&&Telegram.WebApp.initDataUnsafe?.user?.id&&(i=Telegram.WebApp.initDataUnsafe.user.id.toString()),n=`
      user prompt: ${n}
      language of response must be ${e?.code}
      user Info:${t?JSON.stringify(t):"Doesnt have user data"}
    `,this.chatService.sendMessage(n,i).subscribe({next:a=>{this.messages.update(r=>[...r,{role:"bot",text:a.response,time:new Date()}]),this.isLoading.set(!1),typeof Telegram<"u"&&Telegram.WebApp&&Telegram.WebApp.HapticFeedback.notificationOccurred("success");},error:()=>{this.messages.update(a=>[...a,{role:"bot",text:"\u0418\u0437\u0432\u0438\u043D\u0438\u0442\u0435, \u043F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u043E\u0437\u0436\u0435.",time:new Date()}]),this.isLoading.set(!1),typeof Telegram<"u"&&Telegram.WebApp&&Telegram.WebApp.HapticFeedback.notificationOccurred("error");}});}static ɵfac=function(e){return new(e||o)();};static ɵcmp=v({type:o,selectors:[["app-chat"]],viewQuery:function(e,n){if(e&1&&y(q,5),e&2){let i;D(i=I())&&(n.scrollContainer=i.first);}},decls:24,vars:3,consts:()=>{let t;t="\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435";let e;e="\u0417\u0430\u0434\u0430\u0439\u0442\u0435 \u0432\u043E\u043F\u0440\u043E\u0441 \u043E \u043F\u0440\u043E\u0446\u0435\u0434\u0443\u0440\u0430\u0445...";let n;n="\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C";let i;i="AI \u041A\u043E\u043D\u0441\u0443\u043B\u044C\u0442\u0430\u043D\u0442";let a;return a="\u041E\u043D\u043B\u0430\u0439\u043D 24/7",[["scrollContainer",""],i,a,[1,"flex","flex-1","flex-col","bg-gradient-to-b","from-rose-50","to-white","mb-20"],[1,"bg-white/80","backdrop-blur-md","p-4","shadow-sm","flex","items-center","justify-between","sticky","top-0","z-10","border-b","border-rose-100"],[1,"flex","items-center"],[1,"relative"],[1,"w-12","h-12","rounded-full","bg-gradient-to-tr","from-rose-200","to-rose-100","flex","items-center","justify-center","mr-3","shadow-inner","border","border-white"],[1,"text-2xl"],[1,"absolute","bottom-0","right-3","w-3","h-3","bg-green-500","border-2","border-white","rounded-full"],[1,"font-serif","text-lg","text-gray-800","font-medium","tracking-wide"],[1,"text-xs","text-rose-400","font-medium"],[1,"flex-1","overflow-y-auto","p-4","space-y-6","scroll-smooth"],[1,"flex","flex-col","animate-fade-in-up",3,"items-end","items-start"],[1,"flex","items-center","space-x-1.5","ml-2","p-3","bg-white","rounded-2xl","rounded-bl-none","border","border-rose-100","w-fit","shadow-sm"],[1,"p-3","bg-white","border-t","border-rose-100","pb-safe","fixed","bottom-2","w-full"],[1,"flex","gap-2","ml-2","mr-6","items-end","bg-gray-50","p-1.5","rounded-[24px]","border","border-gray-200","focus-within:border-rose-300","focus-within:ring-2","focus-within:ring-rose-100","transition-all"],["rows","1","aria-label",t,"placeholder",e,1,"flex-1","bg-transparent","border-0","rounded-xl","px-4","py-3","focus:ring-0","text-gray-700","placeholder-gray-400","resize-none","max-h-32","min-h-[44px]",3,"ngModelChange","keydown.enter","input","ngModel"],["aria-label",n,1,"bg-rose-500","text-white","w-10","h-10","rounded-full","flex","items-center","justify-center","hover:bg-rose-600","disabled:opacity-50","disabled:hover:bg-rose-500","transition-all","shadow-md","active:scale-95","mb-0.5","mr-0.5",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","ml-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"],[1,"flex","flex-col","animate-fade-in-up"],[1,"max-w-[500px]","p-4","rounded-2xl","text-[15px]","leading-relaxed","relative","group"],[1,"absolute","-left-2","top-0","w-2","h-2","bg-white","border-t","border-l","border-rose-100","[clip-path:polygon(100%_0,0_0,100%_100%)]"],[1,"absolute","-right-2","top-0","w-2","h-2","bg-rose-500","[clip-path:polygon(0_0,100%_0,0_100%)]"],[3,"innerHTML"],[1,"text-[10px]","text-gray-400","mt-1.5","px-1","font-medium","select-none"],[1,"w-2","h-2","bg-rose-300","rounded-full","animate-bounce"],[1,"w-2","h-2","bg-rose-300","rounded-full","animate-bounce","delay-75"],[1,"w-2","h-2","bg-rose-300","rounded-full","animate-bounce","delay-150"]];},template:function(e,n){if(e&1){let i=N();s(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"span",8),E(6,"\u{1F469}\u200D\u2695\uFE0F"),l()(),u(7,"div",9),l(),s(8,"div")(9,"h1",10),b(10,1),l(),s(11,"p",11),b(12,2),l()()()(),s(13,"div",12,0),P(15,te,8,33,"div",13,J),g(17,ne,4,0,"div",14),l(),s(18,"div",15)(19,"div",16)(20,"textarea",17),O("ngModelChange",function(r){return m(i),H(n.newMessage,r)||(n.newMessage=r),p(r);}),A("keydown.enter",function(r){return m(i),p(n.onEnter(r));})("input",function(r){return m(i),p(n.autoResize(r));}),l(),s(21,"button",18),A("click",function(){return m(i),p(n.sendMessage());}),S(),s(22,"svg",19),u(23,"path",20),l()()()()();}e&2&&(d(15),x(n.messages()),d(2),_(n.isLoading()?17:-1),d(3),R("ngModel",n.newMessage),d(),C("disabled",!n.newMessage.trim()||n.isLoading()));},dependencies:[B,X,V,z,G,k],styles:[".pb-safe[_ngcontent-%COMP%]{padding-bottom:env(safe-area-inset-bottom,16px)}.animate-fade-in-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .3s ease-out}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}"]});};export{K as ChatComponent};/**i18n:b82b23be7f7338acfddc6e87193068a65d480bfebda2e4ddab7b7ca5af6f2821*/